<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React 虚拟 DOM 详解</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #3498db;
            margin-top: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        h3 {
            color: #27ae60;
            margin-top: 25px;
        }
        
        p {
            margin: 15px 0;
            text-align: justify;
        }
        
        .concept {
            background-color: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }
        
        .diagram {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .diagram svg {
            max-width: 100%;
            height: auto;
        }
        
        .highlight {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 4px 4px 0;
        }
        
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 10px 0;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>React 虚拟 DOM 详解</h1>
        </header>
        
        <div class="concept">
            <h2>什么是虚拟 DOM？</h2>
            <p>虚拟 DOM（Virtual DOM，简称 VDOM）是 React 核心概念之一，它是真实 DOM 在内存中的表示，是一种编程概念。在 React 中，UI 以虚拟 DOM 的形式保存在内存中，并通过 ReactDOM 等库与“真实的” DOM 同步。</p>
        </div>
        
        <h2>虚拟 DOM 的工作原理</h2>
        <p>React 团队投入大量时间优化 React 的核心算法，以确保应用的高性能。虚拟 DOM 是实现这一目标的关键技术之一。</p>
        
        <div class="diagram">
            <!-- 真实 DOM 与虚拟 DOM 关系图解 -->
            <svg width="800" height="400" xmlns="http://www.w3.org/2000/svg">
                <style>
                    .real-dom { fill: #4CAF50; }
                    .virtual-dom { fill: #2196F3; }
                    .arrow { stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); }
                    .label { font-family: Arial, sans-serif; font-size: 14px; }
                </style>
                
                <!-- 箭头标记定义 -->
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
                    </marker>
                </defs>
                
                <!-- 真实 DOM -->
                <rect x="50" y="50" width="200" height="100" class="real-dom" rx="10" />
                <text x="150" y="90" class="label" text-anchor="middle" fill="white" font-weight="bold">真实 DOM</text>
                <text x="150" y="120" class="label" text-anchor="middle" fill="white">浏览器中的实际元素</text>
                
                <!-- 虚拟 DOM -->
                <rect x="300" y="50" width="200" height="100" class="virtual-dom" rx="10" />
                <text x="400" y="90" class="label" text-anchor="middle" fill="white" font-weight="bold">虚拟 DOM</text>
                <text x="400" y="120" class="label" text-anchor="middle" fill="white">内存中的 JavaScript 对象</text>
                
                <!-- React -->
                <rect x="550" y="50" width="200" height="100" fill="#FF9800" rx="10" />
                <text x="650" y="90" class="label" text-anchor="middle" fill="white" font-weight="bold">React</text>
                <text x="650" y="120" class="label" text-anchor="middle" fill="white">负责协调更新</text>
                
                <!-- 箭头 -->
                <line x1="250" y1="100" x2="300" y2="100" class="arrow" />
                <line x1="500" y1="100" x2="550" y2="100" class="arrow" />
                <line x1="650" y1="150" x2="150" y2="200" class="arrow" />
                <line x1="650" y1="150" x2="400" y2="200" class="arrow" />
                
                <!-- 更新过程 -->
                <rect x="150" y="200" width="100" height="50" fill="#9C27B0" rx="5" />
                <text x="200" y="230" class="label" text-anchor="middle" fill="white">重新渲染</text>
                
                <rect x="400" y="200" width="100" height="50" fill="#9C27B0" rx="5" />
                <text x="450" y="230" class="label" text-anchor="middle" fill="white">计算差异</text>
                
                <line x1="200" y1="250" x2="200" y2="300" class="arrow" />
                <line x1="450" y1="250" x2="450" y2="300" class="arrow" />
                
                <rect x="100" y="300" width="200" height="50" fill="#E91E63" rx="5" />
                <text x="200" y="330" class="label" text-anchor="middle" fill="white">直接操作真实 DOM</text>
                
                <rect x="350" y="300" width="200" height="50" fill="#E91E63" rx="5" />
                <text x="450" y="330" class="label" text-anchor="middle" fill="white">更新虚拟 DOM 树</text>
            </svg>
            <p>图1: 真实 DOM 与虚拟 DOM 的关系及更新流程</p>
        </div>
        
        <h2>虚拟 DOM 的优势</h2>
        <div class="highlight">
            <h3>1. 性能优化</h3>
            <p>虚拟 DOM 通过批量更新和最小化 DOM 操作来提高性能。当状态发生变化时，React 会创建一个新的虚拟 DOM 树，并与之前的虚拟 DOM 树进行比较（diff 算法），只更新实际发生变化的部分。</p>
        </div>
        
        <div class="highlight">
            <h3>2. 抽象化</h3>
            <p>虚拟 DOM 提供了一层抽象，使开发者不需要直接操作复杂的 DOM API，从而提高了开发效率和代码的可维护性。</p>
        </div>
        
        <div class="highlight">
            <h3>3. 跨平台能力</h3>
            <p>虚拟 DOM 的概念不仅限于 Web 平台，还可以应用于移动应用开发（如 React Native），实现一套代码多端运行。</p>
        </div>
        
        <h2>虚拟 DOM 的局限性</h2>
        <div class="concept">
            <h3>1. 内存开销</h3>
            <p>维护虚拟 DOM 树需要额外的内存开销，对于简单的应用可能得不偿失。</p>
        </div>
        
        <div class="concept">
            <h3>2. 不总是最优</h3>
            <p>在某些情况下，手动优化的 DOM 操作可能比虚拟 DOM 的 diff 算法更高效。</p>
        </div>
        
        <div class="diagram">
            <!-- 虚拟 DOM 工作流程图解 -->
            <svg width="800" height="500" xmlns="http://www.w3.org/2000/svg">
                <style>
                    .step { fill: #2196F3; }
                    .arrow { stroke: #333; stroke-width: 2; marker-end: url(#arrowhead2); }
                    .label { font-family: Arial, sans-serif; font-size: 14px; }
                </style>
                
                <!-- 箭头标记定义 -->
                <defs>
                    <marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
                    </marker>
                </defs>
                
                <!-- 步骤1: 状态更新 -->
                <circle cx="100" cy="100" r="40" class="step" />
                <text x="100" y="100" class="label" text-anchor="middle" fill="white" font-weight="bold">1</text>
                <text x="100" y="160" class="label" text-anchor="middle">状态更新</text>
                
                <!-- 步骤2: 重新渲染 -->
                <circle cx="300" cy="100" r="40" class="step" />
                <text x="300" y="100" class="label" text-anchor="middle" fill="white" font-weight="bold">2</text>
                <text x="300" y="160" class="label" text-anchor="middle">重新渲染</text>
                
                <!-- 步骤3: 生成新虚拟 DOM -->
                <circle cx="500" cy="100" r="40" class="step" />
                <text x="500" y="100" class="label" text-anchor="middle" fill="white" font-weight="bold">3</text>
                <text x="500" y="160" class="label" text-anchor="middle">生成新虚拟 DOM</text>
                
                <!-- 步骤4: Diff 算法 -->
                <circle cx="700" cy="100" r="40" class="step" />
                <text x="700" y="100" class="label" text-anchor="middle" fill="white" font-weight="bold">4</text>
                <text x="700" y="160" class="label" text-anchor="middle">Diff 算法</text>
                
                <!-- 步骤5: 计算差异 -->
                <circle cx="100" cy="300" r="40" class="step" />
                <text x="100" y="300" class="label" text-anchor="middle" fill="white" font-weight="bold">5</text>
                <text x="100" y="360" class="label" text-anchor="middle">计算差异</text>
                
                <!-- 步骤6: 更新真实 DOM -->
                <circle cx="300" cy="300" r="40" class="step" />
                <text x="300" y="300" class="label" text-anchor="middle" fill="white" font-weight="bold">6</text>
                <text x="300" y="360" class="label" text-anchor="middle">更新真实 DOM</text>
                
                <!-- 箭头 -->
                <line x1="140" y1="100" x2="260" y2="100" class="arrow" />
                <line x1="340" y1="100" x2="460" y2="100" class="arrow" />
                <line x1="540" y1="100" x2="660" y2="100" class="arrow" />
                <line x1="700" y1="140" x2="700" y2="260" class="arrow" />
                <line x1="660" y1="300" x2="340" y2="300" class="arrow" />
                <line x1="260" y1="300" x2="140" y2="300" class="arrow" />
                <line x1="100" y1="260" x2="100" y2="140" class="arrow" />
            </svg>
            <p>图2: 虚拟 DOM 工作流程</p>
        </div>
        
        <footer>
            <p>React 虚拟 DOM 详解 &copy; 2023</p>
        </footer>
    </div>
</body>
</html>